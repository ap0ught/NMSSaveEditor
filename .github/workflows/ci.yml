name: Build and Test

on:
  push:
    branches: [ master, main ]
  pull_request:
    branches: [ master, main ]

jobs:
  build-and-test:
    runs-on: ubuntu-latest
    
    steps:
    - name: Checkout repository
      uses: actions/checkout@v4
      
    - name: Set up JDK 8
      uses: actions/setup-java@v4
      with:
        java-version: '8'
        distribution: 'temurin'
        
    - name: Verify Java installation
      run: |
        java -version
        javac -version
        
    - name: Check if JAR file exists
      run: |
        if [ -f "NMSSaveEditor.jar" ]; then
          echo "✅ JAR file found"
          ls -la NMSSaveEditor.jar
        else
          echo "❌ JAR file not found"
          exit 1
        fi
        
    - name: Test JAR file execution
      run: |
        # Try to run the JAR to verify it's valid
        java -jar NMSSaveEditor.jar --help || echo "JAR execution test completed"
        
    - name: Verify VERSION.txt
      run: |
        if [ -f "VERSION.txt" ]; then
          echo "✅ VERSION.txt found"
          echo "Version: $(cat VERSION.txt)"
        else
          echo "❌ VERSION.txt not found"
          exit 1
        fi
        
    - name: Check documentation files
      run: |
        echo "Checking essential documentation files..."
        
        files=("README.md" "CHANGELOG.md" "FAQ.md")
        for file in "${files[@]}"; do
          if [ -f "$file" ]; then
            echo "✅ $file exists"
          else
            echo "❌ $file missing"
            exit 1
          fi
        done
        
    - name: Validate README links
      run: |
        echo "Checking for broken internal links in README..."
        if grep -q "FAQ.md" README.md; then
          if [ -f "FAQ.md" ]; then
            echo "✅ FAQ.md link is valid"
          else
            echo "❌ FAQ.md referenced but file missing"
            exit 1
          fi
        fi
        
    - name: Build summary
      run: |
        echo "## Build Summary" >> $GITHUB_STEP_SUMMARY
        echo "- ✅ JAR file verified" >> $GITHUB_STEP_SUMMARY
        echo "- ✅ Documentation complete" >> $GITHUB_STEP_SUMMARY
        echo "- ✅ Version file present: $(cat VERSION.txt)" >> $GITHUB_STEP_SUMMARY
        echo "- ✅ All checks passed" >> $GITHUB_STEP_SUMMARY